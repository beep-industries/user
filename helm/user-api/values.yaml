# Default values for user-api

replicaCount: 1

image:
  repository: ghcr.io/beep-industries/user
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Main API service (port 3000 - JWT protected)
service:
  type: ClusterIP
  port: 3000

# Health service (port 3001 - health checks)
healthService:
  enabled: true
  port: 3001

# Gateway API HTTPRoute
httpRoute:
  enabled: false
  # Gateway reference
  parentRefs:
    - name: main-gateway
      namespace: ""
      sectionName: ""
  hostnames:
    - user-api.local
  # Additional route rules
  rules: []

resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Database migration job
migration:
  enabled: true
  # Set to true to run migrations on every upgrade
  runOnUpgrade: true

# Application configuration
config:
  # Server configuration
  server:
    host: "0.0.0.0"
    port: 3000
    healthPort: 3001

  # Logging
  logLevel: "info"

# Keycloak configuration
keycloak:
  # External URL (client-facing)
  url: "http://keycloak:8080"
  # Internal URL (service-to-service, within cluster)
  internalUrl: "http://keycloak:8080"
  realm: "myrealm"
  clientId: "user-service"
  # Client secret - use existingSecret in production
  clientSecret: ""
  existingSecret: ""
  existingSecretKey: "client-secret"

# Database configuration
database:
  host: "user-db"
  port: 5432
  name: "userservice"
  user: "userservice"
  password: ""
  sslMode: "prefer"
  # Use existing secret for credentials (e.g., Zalando postgres-operator)
  # Set existingSecret to get password from an existing secret
  existingSecret: ""
  passwordSecretKey: "password"
  usernameSecretKey: "username"  # optional, falls back to database.user

# OpenTelemetry configuration
opentelemetry:
  enabled: false
  endpoint: "http://otel-collector:4317"

# Probes configuration
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

contentService:
  url: "http://content:80"
